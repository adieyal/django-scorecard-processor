{% extends 'base.html' %}
{% load i18n %}
{% block head_title %}Response to {{survey.name}} for {{entity.name}}{% endblock %}
{% block script_bottom %}
{{block.super}}
<script type="text/javascript">
$('.actions').hide();
$('ul.tabs').tabs();
$('ul.tabs').bind('change', function (e) {
  //window.console.log() // activated tab
  var href=$(e.target).attr('href');
  $('#next').attr('value',href.substring(1));
  if ($(e.target).parent().attr('id')=='intro_tab') {
    $('.actions').hide();
  } else {
    $('.actions').show();
  }
})
$('#continue_button').bind('click', function(e) {
  $($('.tabs li a')[1]).click();
  e.preventDefault();
})

next = false;
if (window.location.hash) {next = window.location.hash;}
if ($('.error').length) {
  next = '#'+$($('.error')[0]).parents('div.tab-pane').attr('id');
}

if (next) {
  $('a',next.replace('#','#t')).click();
}

</script>
<style>
  .legend.span5 {clear:left}
  .fields.span10 {float:right}
  label .identifier {margin-right:0.5em;}
  .form-stacked .clearfix div.input {clear:left;padding:5px 0 20px 20px}
  .input .currency {margin-right:0.5em;}
  select.currency_select {display:none}
</style>
{% endblock %}

{% block fluid_content_outer %}
  <div class="container">
    <div class="content">
      <div class="page-header">
        <h1>{{survey.name}} <small>for <a href="{{entity.get_absolute_url}}">{{entity.name}}</a> - {{data_series}}</small></h1>
      </div>
      <form method="POST" class="form-stacked">
          {% csrf_token %}
          <div class="row">
            <div class="span14">
              <ul class="tabs">
                <li class="active" id="intro_tab"><a href="#intro">Overview</a></li>
                {% for group in survey.questiongroup_set.all %}
                  <li id="tqg_{{group.pk|slugify}}"><a href="#qg_{{group.pk|slugify}}">{{forloop.counter}}</a></li>
                {% endfor %}
              </ul>
              <div class="form tab-content">
                <div class="tab-pane active" id="intro">
                  <p>{{survey.description|safe}}</p>
                  <div class="row">
                    <div class="span4">
                      <label>{{form.currency.label}}</label>
                      {{form.currency}}
                    </div>

                    <div class="span4">
                      <label>{{form.baseline_year.label}}</label>
                      {{form.baseline_year}}
                    </div>

                    <div class="span4">
                      <label>{{form.current_year.label}}</label>
                      {{form.current_year}}
                    </div>
                  </div>
                  <button class="btn primary large pull-right" id="continue_button">{% blocktrans %}Continue{%endblocktrans%}</button>
                </div>
                {{form.as_div}}
              </div>
              <input type="hidden" id="next" name="next" value="" />
              <div class="actions" style="display:none">
                  <button type="submit" class="pull-right btn primary large" name="button">{% blocktrans %}Save and continue{% endblocktrans %}</button> &nbsp;
              </div>
            </div>
            
          </div>
      </form>
    </div>
  </div>
{% endblock %}
